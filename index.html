<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>A-Frame Galaxy Scene</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-star-system-component@1.0.0/dist/aframe-star-system-component.min.js"></script>
    <script>  
      AFRAME.registerComponent('planet-click', {
        init: function () {
          this.el.addEventListener('click', function () {
            const camera = document.querySelector('[camera]');
            const shop = document.querySelector('#shop');
            const planet = document.querySelector('#planet');
            
            // Â∞ÜÁõ∏Êú∫ÁßªÂä®Âà∞Áõ∏ÂØπ‰∫éplanetÁöÑÂõ∫ÂÆö‰ΩçÁΩÆ
            camera.setAttribute('animation', {
              property: 'position',
              to: '-2 1.524 -0.755',
              dur: 2000,
              easing: 'easeInOutQuad'
            });
            
            camera.setAttribute('animation__rotation', {
              property: 'rotation',
              to: '25.265 -34.750 -12.507',
              dur: 2000,
              easing: 'easeInOutQuad'
            });
            
            // 2ÁßíÂêéÂºÄÂßãÁõ∏Êú∫Ë∑üÈöèplanetÊóãËΩ¨
            setTimeout(() => {
              // Â∞ÜÁõ∏Êú∫‰Ωú‰∏∫planetÁöÑÂ≠êÂÖÉÁ¥†ÔºåËøôÊ†∑Áõ∏Êú∫‰ºöËá™Âä®Ë∑üÈöèplanetÊóãËΩ¨
              planet.appendChild(camera);
              
              // Ë∞ÉÊï¥Áõ∏Êú∫Âú®planetÂùêÊ†áÁ≥ª‰∏ãÁöÑ‰ΩçÁΩÆÂíåÊóãËΩ¨
              camera.setAttribute('position', '3 6.524 4.245');
              camera.setAttribute('rotation', '25.265 -34.750 -12.507');
            }, 2000);
            
            // Start shop rotation animation
            shop.setAttribute('animation__shop_rotation', {
              property: 'rotation',
              to: '0 180.122 -11.157',
              dur: 3000,
              easing: 'easeInOutSine',
              loop: true,
              dir: 'alternate'
            });
            
            // Start complex car animations
            startCarAnimations();
          });
        }
      });

      AFRAME.registerComponent('background-click', {
        init: function () {
          this.el.addEventListener('click', function (evt) {
            if (evt.target === this) {
              const camera = document.querySelector('[camera]');
              const shop = document.querySelector('#shop');
              const scene = document.querySelector('a-scene');
              
              // Â∞ÜÁõ∏Êú∫‰ªéplanetÁßªÂõûsceneÊ†πËäÇÁÇπ
              scene.appendChild(camera);
              
              camera.setAttribute('animation', {
                property: 'position',
                to: '0 1.6 10',
                dur: 2000,
                easing: 'easeInOutQuad'
              });
              
              camera.setAttribute('animation__rotation', {
                property: 'rotation',
                to: '0 0 0',
                dur: 2000,
                easing: 'easeInOutQuad'
              });
              
              // Stop shop rotation and reset to original rotation
              shop.removeAttribute('animation__shop_rotation');
              shop.setAttribute('rotation', '0 -179.878 -11.157');
              
              // Stop car animations
              stopCarAnimations();
            }
          });
        }
      });

      function startCarAnimations() {
        const caffeeCar = document.querySelector('#caffee-car');
        const icecreamCar = document.querySelector('#icecream-car');

        // ÂíñÂï°ËΩ¶ÔºöÂú®Ë°åÊòüË°®Èù¢ÂÅöÊ§≠ÂúÜÂΩ¢ËΩ®ÈÅìËøêÂä®ÔºåÊ®°ÊãüÊ≤øÁùÄË°åÊòüË°®Èù¢È©æÈ©∂
        caffeeCar.setAttribute('animation__position1', {
          property: 'position',
          to: '1.2 1.8 -0.8',
          dur: 3000,
          easing: 'easeInOutSine'
        });
        caffeeCar.setAttribute('animation__rotation1', {
          property: 'rotation',
          to: '10 45 -5',
          dur: 3000,
          easing: 'easeInOutSine'
        });

        setTimeout(() => {
          caffeeCar.setAttribute('animation__position2', {
            property: 'position',
            to: '0.5 2.2 0.9',
            dur: 4000,
            easing: 'easeInOutSine'
          });
          caffeeCar.setAttribute('animation__rotation2', {
            property: 'rotation',
            to: '-15 120 8',
            dur: 4000,
            easing: 'easeInOutSine'
          });
        }, 3000);

        setTimeout(() => {
          caffeeCar.setAttribute('animation__position3', {
            property: 'position',
            to: '-1.1 1.6 0.3',
            dur: 3500,
            easing: 'easeInOutSine'
          });
          caffeeCar.setAttribute('animation__rotation3', {
            property: 'rotation',
            to: '5 200 -12',
            dur: 3500,
            easing: 'easeInOutSine'
          });
        }, 7000);

        setTimeout(() => {
          caffeeCar.setAttribute('animation__position4', {
            property: 'position',
            to: '.137 1.428 -1.263',
            dur: 3500,
            easing: 'easeInOutSine'
          });
          caffeeCar.setAttribute('animation__rotation4', {
            property: 'rotation',
            to: '-18.98 -23.95 4.342',
            dur: 3500,
            easing: 'easeInOutSine'
          });
        }, 10500);

        // ÂÜ∞Ê∑áÊ∑ãËΩ¶ÔºöÂú®Ë°åÊòüË°®Èù¢ÂÅöÂè¶‰∏Ä‰∏™Ë∑ØÂæÑÔºåÊ®°ÊãüÂú®‰∏çÂêåÂå∫ÂüüÈ©æÈ©∂
        icecreamCar.setAttribute('animation__position1', {
          property: 'position',
          to: '-1.3 1.9 0.2',
          dur: 2500,
          easing: 'easeInOutSine'
        });
        icecreamCar.setAttribute('animation__rotation1', {
          property: 'rotation',
          to: '12 -80 -8',
          dur: 2500,
          easing: 'easeInOutSine'
        });

        setTimeout(() => {
          icecreamCar.setAttribute('animation__position2', {
            property: 'position',
            to: '0.2 2.1 1.1',
            dur: 3500,
            easing: 'easeInOutSine'
          });
          icecreamCar.setAttribute('animation__rotation2', {
            property: 'rotation',
            to: '-20 15 15',
            dur: 3500,
            easing: 'easeInOutSine'
          });
        }, 2500);

        setTimeout(() => {
          icecreamCar.setAttribute('animation__position3', {
            property: 'position',
            to: '1.0 1.7 -0.5',
            dur: 4000,
            easing: 'easeInOutSine'
          });
          icecreamCar.setAttribute('animation__rotation3', {
            property: 'rotation',
            to: '8 85 -10',
            dur: 4000,
            easing: 'easeInOutSine'
          });
        }, 6000);

        setTimeout(() => {
          icecreamCar.setAttribute('animation__position4', {
            property: 'position',
            to: '-0.846 1.329 -1.078',
            dur: 4000,
            easing: 'easeInOutSine'
          });
          icecreamCar.setAttribute('animation__rotation4', {
            property: 'rotation',
            to: '-8.617 -40.73 2.92',
            dur: 4000,
            easing: 'easeInOutSine'
          });
        }, 10000);

        // Âæ™ÁéØÂä®Áîª
        setTimeout(() => {
          startCarAnimations();
        }, 14000);
      }

      function stopCarAnimations() {
        const caffeeCar = document.querySelector('#caffee-car');
        const icecreamCar = document.querySelector('#icecream-car');

        // ÁßªÈô§ÊâÄÊúâÂä®Áîª
        caffeeCar.removeAttribute('animation__position1');
        caffeeCar.removeAttribute('animation__position2');
        caffeeCar.removeAttribute('animation__position3');
        caffeeCar.removeAttribute('animation__position4');
        caffeeCar.removeAttribute('animation__rotation1');
        caffeeCar.removeAttribute('animation__rotation2');
        caffeeCar.removeAttribute('animation__rotation3');
        caffeeCar.removeAttribute('animation__rotation4');

        icecreamCar.removeAttribute('animation__position1');
        icecreamCar.removeAttribute('animation__position2');
        icecreamCar.removeAttribute('animation__position3');
        icecreamCar.removeAttribute('animation__position4');
        icecreamCar.removeAttribute('animation__rotation1');
        icecreamCar.removeAttribute('animation__rotation2');
        icecreamCar.removeAttribute('animation__rotation3');
        icecreamCar.removeAttribute('animation__rotation4');

        // ÊÅ¢Â§çÂéüÂßã‰ΩçÁΩÆÂíåÊóãËΩ¨
        caffeeCar.setAttribute('position', '.137 1.428 -1.263');
        caffeeCar.setAttribute('rotation', '-18.98 -23.95 4.342');
        icecreamCar.setAttribute('position', '-0.846 1.329 -1.078');
        icecreamCar.setAttribute('rotation', '-8.617 -40.73 2.92');
      }
    </script>
  </head>
  <body>
    <a-scene background-click cursor="rayOrigin: mouse">
      <!-- resources -->
      <a-assets>
        <img id="skyTexture" src="assets/sky/starsmilky.jpg" />
        <a-asset-item id="UFO" src="assets/model/UFO_Empty.glb"></a-asset-item>
        <a-asset-item id="planet" src="assets/model/Planet.glb"></a-asset-item>
        <a-asset-item id="caffee-car" src="assets/model/car/caffe_car.glb"></a-asset-item>
        <a-asset-item id="icereamcar" src="assets/model/car/ice_cream_car.glb"></a-asset-item>
        <a-asset-item id="shop" src="assets/model/house/ice_cream_shop.glb"></a-asset-item>
      </a-assets>

      <!-- üåå star background and spin -->
      <a-sky 
        src="#skyTexture"
        rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 60000; easing: linear">
      </a-sky>

      <!-- ‚ú® shinning star -->
      <a-entity star-system="count: 1000; radius: 100; depth: 80; color: #ffffff; speed: 0.1"></a-entity>

      <!-- ü™ê self-spin Planet -->
      <a-entity 
        id="planet"
        gltf-model="#planet"
        position="0 0 -5"
        scale="1 1 1"
        rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear"
        planet-click
        class="clickable">
        
        <!-- shop on the planet -->
        <a-entity 
          id="shop"
          gltf-model="#shop"
          position="-0.391 2.651 -0.422"
          scale="0.452 0.452 0.452"
          rotation="0 -179.878 -11.157">
        </a-entity>

        <!-- car-orbit -->
        <a-entity 
          id="car-orbit" 
          position="0 1.2 0">
          
          <!-- coffee -->
          <a-entity
            id="caffee-car"
            gltf-model="#caffee-car"
            position=".137 1.428 -1.263"
            scale="0.065 0.065 0.065"
            rotation="-18.98 -23.95 4.342">
          </a-entity>

          <!-- icecream -->
          <a-entity
            id="icecream-car"
            gltf-model="#icereamcar"
            position="-0.846 1.329 -1.078"
            scale=".06 .06 .06"
            rotation="-8.617 -40.73 2.92">
          </a-entity>
        </a-entity>
      </a-entity>

      <!-- üõ∏ UFO orbit div -->
      <a-entity 
        id="ufo-orbit" 
        position="0 0 -5"
        scale="2.5 2.5 2.5"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 15000; easing: linear">
        
        <!-- üöÄ UFO self spin -->
        <a-entity
          gltf-model="#UFO"
          position="3 0 0"
          scale=".25 .25 .25"
          rotation="0 0 0"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear">
        </a-entity>

        <!-- üåÄ UFO orbit -->
        <a-torus 
          color="#ffffff" 
          radius="3" 
          radius-tubular="0.01"
          arc="360"
          rotation="90 0 0"
          segments-radial="36"
          segments-tubular="100"
          material="opacity: 0.3; transparent: true;">
        </a-torus>
      </a-entity>

      <!-- light and camera -->
      <a-light 
        type="directional" 
        color="#f0f5ff"
        position="-2.5 3.2 2"
        intensity="3.14"
        ></a-light>
      <a-light 
        type="directional" 
        color="#b3b3b3"
        position="2 1.3 3.4"
        intensity="2.9"
        ></a-light>
      <a-entity camera look-controls wasd-controls position="0 1.6 10"></a-entity>
    </a-scene>
  </body>
</html>